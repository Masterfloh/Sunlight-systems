import discord as interactions
import requests
import discord
import json

bot = interactions.Client
Check1 = int(0)
Check2 = int(0)



@bot.event
async def on_ready():

    print(f"Version 1.0.0 active!")
    print(f"By Nic and Masterfloh")

# Get Slash cmd and  collect url

@bot.command(
    name="scan",
    description="Will Scan for suspicious links given",
    scope=1044949171397996575,
    options = [
        interactions.Option(
            name="urltoscan",
            description="What url do you want to scan",
            type=interactions.OptionType.STRING,
            required=True,
        ),
    ],
)

async def my_first_command(ctx: interactions.CommandContext, urltoscan: str):
    global VTUrl # Declare url as global env for later
    VTUrl = urltoscan
    if "http" in urltoscan:
        await ctx.send(f"Please remove http/https, only send the url without http or https:// **Example: my-url.com**")
    else:


        await ctx.send(f"This may take a moment!")
        #checks 2 github repos
        GitCheck1 = "https://raw.githubusercontent.com/nikolaischunk/discord-phishing-links/main/txt/domain-list.txt"
        GitCheck2 = "https://raw.githubusercontent.com/mitchellkrogza/Phishing.Database/master/phishing-domains/output/domains/ACTIVE/list"
        GitCheck1Output = requests.get(GitCheck1).text.split('\n')
        GitCheck2Output = requests.get(GitCheck2).text.split('\n')
        if urltoscan in GitCheck1Output or GitCheck2Output:
            Check1 + int(1)
            #for later
            

#TotalVirusApi

payload = VTUrl
headers = {
    "accept": "application/json",
    "x-apikey": "YourAPIKey",
    "content-type": "application/x-www-form-urlencoded"
}
parameters = {'apikey': "YourAPIKey", 'resource': VTUrl}
response= requests.get(url=VTUrl, params=parameters)
json_response= json.loads(response.text)
if json_response['positives'] <= 0:
    Check2 + int(0)
else:
    Check2 + int(1)


@bot.event
async def evaluate(ctx):
    if int(Check1) + int(Check2) <= 1:
        await ctx.send(f"**Attention!** {VTUrl} is a known phishing / scam link! Dont click on it/put in informations!")

bot.start("Your Discord bot Token")
